<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SYNVIKO App</title>

<style>
body{font-family:Arial, sans-serif;margin:0;background:#0b1733;color:white}
header{background:#09122b;padding:15px;text-align:center;font-size:20px;font-weight:bold}
.container{padding:15px}

.panel-btn{
width:100%;padding:14px;margin:8px 0;border:none;border-radius:14px;
background:#3c6fd1;color:white;font-size:16px;font-weight:bold;
}

.panel{
background:#101c3f;
padding:15px;
border-radius:14px;
margin-top:5px;
display:none;
}

input,select{
width:100%;
padding:14px;
margin:6px 0;
border-radius:12px;
border:none;
}

button.action{
background:#3c6fd1;
color:white;
border:none;
padding:14px;
border-radius:12px;
width:100%;
font-weight:bold;
margin-top:8px;
}

.status{
background:#eee;
color:#000;
padding:8px;
border-radius:8px;
margin-top:8px;
}
</style>
</head>

<body>

<header>SYNVIKO</header>

<div class="container">

<button class="panel-btn" onclick="togglePanel('envio')">ğŸšš Nuevo EnvÃ­o</button>
<div id="envio" class="panel">

<input id="clienteNombre" placeholder="Nombre del cliente">
<input id="clienteTelefono" placeholder="TelÃ©fono cliente">
<input id="origen" placeholder="DirecciÃ³n recogida">
<input id="destino" placeholder="DirecciÃ³n entrega">

<input id="km" placeholder="Distancia automÃ¡tica" disabled>
<input id="precio" placeholder="Tarifa estimada" disabled>

<button class="action" onclick="calcularDistancia()">Calcular distancia y tarifa</button>
<button class="action" onclick="verRuta()">Ver ruta en mapa</button>

<button class="action" onclick="crearPedido()">Crear pedido</button>

<div id="estadoPedido" class="status">Sin pedido creado</div>
</div>

<button class="panel-btn" onclick="togglePanel('pedidos')">ğŸ“¦ Pedidos Activos</button>
<div id="pedidos" class="panel">
<div id="listaPedidos"></div>
</div>

<button class="panel-btn" onclick="togglePanel('registro')">ğŸ“ Solicitar registro</button>
<div id="registro" class="panel">

<select id="tipoRegistro">
<option value="cliente">Cliente</option>
<option value="motorizado">Motorizado</option>
</select>

<input id="nombreRegistro" placeholder="Nombre completo">
<input id="telefonoRegistro" placeholder="TelÃ©fono">

<button class="action" onclick="solicitarRegistro()">Enviar solicitud</button>
<div id="estadoRegistro" class="status">Sin solicitud enviada</div>

</div>

<button class="panel-btn" onclick="abrirWhatsApp()">ğŸ“„ GestorÃ­a</button>

<!-- Panel Admin -->
<div class="panel">
<h3>Panel Administrador</h3>
<input id="passAdmin" placeholder="ContraseÃ±a">
<button class="action" onclick="loginAdmin()">Entrar</button>
<div id="adminPanel" class="hidden">
<h4>Solicitudes pendientes</h4>
<div id="solicitudes"></div>

<h4>Pedidos pendientes</h4>
<div id="pedidosAdmin"></div>
</div>
</div>

</div>

<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key=TU_API_KEY&libraries=places"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
apiKey: "AIzaSyClYtHMWFy6eyUg4eXMo_1zlQE9a3Occ04",
authDomain: "synviko-97da5.firebaseapp.com",
databaseURL: "https://synviko-97da5-default-rtdb.firebaseio.com",
projectId: "synviko-97da5",
storageBucket: "synviko-97da5.firebasestorage.app",
messagingSenderId: "770434547807",
appId: "1:770434547807:web:e6f456509a996d69aa1bea"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function togglePanel(id){
    let panel=document.getElementById(id);
    panel.style.display = panel.style.display==="block" ? "none" : "block";
}

/* -------- DISTANCIA REAL -------- */
async function calcularDistancia(){
    let origen = document.getElementById("origen").value;
    let destino = document.getElementById("destino").value;

    if(!origen || !destino){
        alert("Ingrese direcciones");
        return;
    }

    let service = new google.maps.DistanceMatrixService();

    service.getDistanceMatrix({
        origins: [origen],
        destinations: [destino],
        travelMode: 'DRIVING',
        unitSystem: google.maps.UnitSystem.METRIC
    }, function(response, status){
        if(status !== 'OK'){
            alert('Error al calcular la distancia: ' + status);
        } else {
            let result = response.rows[0].elements[0];
            if(result.status === "OK"){
                let km = result.distance.value / 1000; // metros a km
                document.getElementById("km").value = km.toFixed(2) + " km";
                document.getElementById("precio").value = "$" + (km * 0.5).toFixed(2);
            } else {
                alert('No se pudo obtener la distancia.');
            }
        }
    });
}

function verRuta(){
    let o=document.getElementById("origen").value;
    let d=document.getElementById("destino").value;
    window.open("https://www.google.com/maps/dir/"+o+"/"+d);
}

/* -------- REGISTRO -------- */
function solicitarRegistro(){
    let nombre=document.getElementById("nombreRegistro").value;
    let telefono=document.getElementById("telefonoRegistro").value;
    let tipo=document.getElementById("tipoRegistro").value;

    if(!nombre || !telefono){
        alert("Complete todos los campos");
        return;
    }

    db.ref("solicitudes").push({
        nombre,nombre,
        telefono,telefono,
        tipo:tipo,
        estado:"pendiente"
    });

    document.getElementById("estadoRegistro").innerText = "Solicitud enviada. Pendiente aprobaciÃ³n.";
}

/* -------- PEDIDOS -------- */
function crearPedido(){
    let cliente=document.getElementById("clienteNombre").value;
    let telefono=document.getElementById("clienteTelefono").value;
    let origen=document.getElementById("origen").value;
    let destino=document.getElementById("destino").value;
    let distancia=document.getElementById("km").value;
    let precio=document.getElementById("precio").value;

    if(!cliente || !telefono || !origen || !destino){
        alert("Complete todos los campos");
        return;
    }

    db.ref("pedidos").push({
        cliente,telefono,origen,destino,distancia,precio,estado:"Pendiente"
    });

    document.getElementById("estadoPedido").innerText="Pedido creado";
}

/* -------- CARGAR PEDIDOS -------- */
db.ref("pedidos").on("value",snap=>{
    let lista=document.getElementById("listaPedidos");
    let listaAdmin=document.getElementById("pedidosAdmin");
    lista.innerHTML="";
    listaAdmin.innerHTML="";

    snap.forEach(p=>{
        let d=p.val();
        let item=document.createElement("div");
        item.className="status";
        item.innerHTML="Cliente: "+d.cliente+"<br>Distancia: "+d.distancia+"<br>Tarifa: "+d.precio+"<br>Estado: "+d.estado;
        lista.appendChild(item);

        // Panel admin
        let itemAdmin=document.createElement("div");
        itemAdmin.className="status";
        itemAdmin.innerHTML="Cliente: "+d.cliente+"<br>Distancia: "+d.distancia+"<br>Tarifa: "+d.precio+"<br>Estado: "+d.estado;
        listaAdmin.appendChild(itemAdmin);
    });
});

/* -------- PANEL ADMIN -------- */
function loginAdmin(){
    let clave=document.getElementById("passAdmin").value;
    if(clave==="1234"){
        document.getElementById("adminPanel").classList.remove("hidden");
        cargarSolicitudes();
    } else alert("Clave incorrecta");
}

function cargarSolicitudes(){
    db.ref("solicitudes").on("value",snap=>{
        let div=document.getElementById("solicitudes");
        div.innerHTML="";
        snap.forEach(s=>{
            let d=s.val();
            if(d.estado==="pendiente"){
                let item=document.createElement("div");
                item.className="status";
                item.innerHTML=d.nombre+" - "+d.tipo+
                "<button onclick=\"aprobarSolicitud('"+s.key+"')\">Aprobar</button>";
                div.appendChild(item);
            }
        });
    });
}

function aprobarSolicitud(id){
    db.ref("solicitudes/"+id).update({estado:"aprobado"});
}

/* -------- GESTORÃA -------- */
function abrirWhatsApp(){
    window.open("https://wa.me/593987697105","_blank");
}

</script>

</body>
</html>
